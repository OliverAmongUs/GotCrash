<html>
<head>
<link rel="apple-touch-icon" href="apple-icon.png">
<link rel="shortcut icon" href="favicon.ico">
<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800' rel='stylesheet' type='text/css'>

<%= stylesheet_link_tag "admin.css" %>
<%= javascript_include_tag "admin.js" %>
</head>

<body>
    <!-- Left Panel -->
    <%= render "layouts/left_panel" %>
    <!-- Left Panel -->

    <!-- Right Panel -->

    <div id="right-panel" class="right-panel">

        <!-- Header-->
        <%= render "layouts/header" %>
        <!-- Header-->

        <div class="breadcrumbs">
            <div class="col-sm-4">
                <div class="page-header float-left">
                    <div class="page-title">
                        <h1>Report #<%=@report.id%></h1>
                    </div>
                </div>
            </div>

            <div class="col-sm-8">
                <div class="page-header float-right">
                    <div class="page-title">
                        <ol class="breadcrumb text-right">
                            <li><a href="/">GotCrash</a></li>
                            <li><a href="/reports">My Reports</a></li>
                            <li class="active">#<%=@report.id%></li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>

        <div class="content mt-3">
            <div class="animated fadeIn">
            <div class="row">
            <div class="col-lg-10">
            <div class="card">
              <div class="card-body card-block">
                <div class="col-lg-6" >
                  <%= image_tag @report.picture_url_url.to_s, style:"height:230px;"%>
                </div>
                <div class="col-lg-6">
                  <h3 class="padding_label">
                    <strong>Car:</strong>
                    <%= Car.find(@report.car_id).licence %>
                  </h3>
                  <hr>
                  <h3 class="padding_label">
                    <strong>Privacy:</strong>
                    <% if @report.privacy == 0 %> Public
                    <% else %> Private <% end %>
                  </h3>
                  <hr>
                  <h3 class="padding_label">
                    <strong>Completed:</strong>
                    <% if @report.completed == 0 %> No
                    <% else %> Yes <% end %>
                  </h3>

                </div>

                <div class="col-lg-12" >
                  <hr>
                  <h3 class="padding_label">
                    <strong>Address:</strong>
                    <%= @report.address %>
                  </h3>
                  <hr>
                  <h3 class="padding_label">
                    <strong>Description:</strong>
                    <%= @report.description %>
                  </h3>
                  <hr>
                  <h3 class="padding_label">
                    <strong>Label:</strong>
                    <% rjas = ReportJoinAuto.where(report_id: @report.id) %>
                    <% rjas.each do |rja| %>
                      <br>
                      <%= AutoPart.where(id: rja.auto_part_id).to_a[0].name %>
                    <% end %>
                  </h3>
                </div>

                <div class="col-lg-12" >
                <h3 class="padding_label">
                  <strong>Bids received:</strong>
                </h3>

                <%if @report.completed == 0%>

                  <table class="table table-striped">
                    <thead>
                      <tr>
                        <th colspan="1"></th>
                        <th>Description</th>
                        <th>Auto shop</th>
                        <th>Price</th>
                        <th colspan="3"></th>
                      </tr>
                    </thead>

                    <tbody>
                      <% @bids.each do |bid| %>
                        <tr>
                          <!-- <td><%= link_to '<button type="button"  class="btn btn-primary data-toggle="modal" data-target="#smallmodal"">Choose this</button>'.html_safe,report_path(bids: @bids,chosen: bid,reportID: bid.report_id),method: :post%></td> -->
                          <td><button type="button"  class="btn btn-primary" data-toggle="modal" data-target="#smallmodal"">Choose this</button></td>
                          <td><%= bid.description %></td>
                          <td><%= User.find(bid.fixer_id).name %></td>
                          <td><%= bid.cost %>$</td>
                          <td><%= link_to 'Details', fixer_bid_path(current_user,bid) %></td>
                          <td><%= link_to 'Add Review', reviews_new_path(fixerID: bid.fixer_id, reportID: bid.report_id) %></td>
                          <td><%= link_to 'Conversation', fixer_bid_messages_path(bid.fixer_id,bid.id) %></td>
                        </tr>
                      <% end %>
                    </tbody>
                  </table>

                  <div class="modal fade" id="smallmodal" tabindex="-1" role="dialog" aria-labelledby="smallmodalLabel" aria-hidden="true">
                      <div class="modal-dialog modal-sm" role="document">
                          <div class="modal-content">
                              <div class="modal-header">
                                  <h5 class="modal-title" id="smallmodalLabel">Small Modal</h5>
                                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                      <span aria-hidden="true">&times;</span>
                                  </button>
                              </div>
                              <div class="modal-body">
                                  <p>
                                      There are three species of zebras: the plains zebra, the mountain zebra and the Grévy's zebra. The plains zebra
                                      and the mountain zebra belong to the subgenus Hippotigris, but Grévy's zebra is the sole species of subgenus
                                      Dolichohippus. The latter resembles an ass, to which it is closely related, while the former two are more
                                      horse-like. All three belong to the genus Equus, along with other living equids.
                                  </p>
                              </div>
                              <div class="modal-footer">
                                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                  <button type="button" class="btn btn-primary">Confirm</button>
                              </div>
                          </div>
                      </div>
                  </div>
            <%else %>
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>Description</th>
                      <th>Auto shop</th>
                      <th>Price</th>
                      <th colspan="3"></th>
                    </tr>
                  </thead>

                  <tbody>
                    <% @bids.each do |bid| %>
                      <% if bid.marked == 1 %>
                      <tr>
                        <td><%= bid.description %></td>
                        <td><%= User.find(bid.fixer_id).name %></td>
                        <td><%= bid.cost %>$</td>
                        <td><%= link_to 'Details', fixer_bid_path(current_user,bid) %></td>
                        <td><%= link_to 'Add Review', reviews_new_path(fixerID: bid.fixer_id, reportID: bid.report_id) %></td>
                        <td><%= link_to 'Conversation', fixer_bid_messages_path(bid.fixer_id,bid.id) %></td>
                      </tr>
                      <% end %>
                      <% end %>
                  </tbody>
                </table>

              <% end %>
                </div>


                <div class="col-lg-6 margintop_btn">
                  <%= link_to 'Edit report', edit_report_path(@report), class: "btn btn-danger  edit_move2" %>
                </div>
                <div class="col-lg-2 col-lg-offset-4 margintop_btn">

                  <%= link_to 'Back', reports_path, class: "btn btn-primary", style: "width:100px"  %>
                </div>

              </div>
            </div>
          </div>
        </div>
        </div>

    </div><!-- /#right-panel -->


  </body>

  <script type="text/javascript">
    $(function(){
      $(".navbar-nav>li").eq(2).addClass("active");
    });
  </script>
</html>
